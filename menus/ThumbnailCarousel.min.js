(function(a){ThumbnailCarousel=function(e,g,f,d,c,b){SimpleGeometry.Rectangle.call(this,e,g,f,d);this.context2d=c;this.outlineThickness=4;this.animator=new UnitAnimator();this.arrows=new ArrowButtons(this);this.hotSpot=new SimpleGeometry.Rectangle();if(b){this.setImages(b)}};ThumbnailCarousel.prototype=Object.create(SimpleGeometry.Rectangle.prototype);ThumbnailCarousel.prototype.constructor=SimpleGeometry.Rectangle;ThumbnailCarousel.prototype.next=function(){if(this.animator.isAnimating()){return}this.slide(1)};ThumbnailCarousel.prototype.previous=function(){if(this.animator.isAnimating()){return}this.slide(-1)};ThumbnailCarousel.prototype.getCurrentImage=function(){for(var b=0;b<this.items.length;b++){if(this.items[b].itemId==(this.currentIndex==0?0:(this.images.length-this.currentIndex))){return this.items[b].image}}return null};ThumbnailCarousel.prototype.setImages=function(b){this.images=b;this.radius=this.width/2-b[0].width/2;this.segmentRadian=SimpleGeometry.PI2/this.images.length;this.currentIndex=0;this.setUpCarousel();this.renderThumbnails()};ThumbnailCarousel.prototype.setUpCarousel=function(){this.items=[];var f=Math.PI/2;var b=this.getCenter();var d,e;for(var c=0;c<this.images.length;c++){d=new SimpleGeometry.Rectangle();d.x=b.x+Math.cos(f)*this.radius;d.y=b.y;e=SimpleGeometry.map(Math.max(b.x,d.x)-Math.min(b.x,d.x),0,this.radius,1,0.5);d.width=e*this.images[c].width;d.height=e*this.images[c].height;this.items[c]=new ThumbnailCarouselItem(c,this.images[c],e,SimpleGeometry.constrainRadianTo2PI(f),d);f+=this.segmentRadian}this.anchorItem=this.items[0];this.hotSpot=new SimpleGeometry.Rectangle(this.anchorItem.rectangle.x-this.anchorItem.rectangle.width/2,this.anchorItem.rectangle.y-this.anchorItem.rectangle.height/2,this.anchorItem.rectangle.width,this.anchorItem.rectangle.height)};ThumbnailCarousel.itemsScaleSort=function(d,c){return parseFloat(d.scale)-parseFloat(c.scale)};ThumbnailCarousel.prototype.renderThumbnailOutlines=function(){this.context2d.fillStyle=this.outlineColor;for(var b=0;b<this.items.length;b++){item=this.items[b];if(SimpleGeometry.constrainRadianTo2PI(item.radian)<=Math.PI){this.context2d.fillRect(item.rectangle.x-item.rectangle.width/2-this.outlineThickness,item.rectangle.y-item.rectangle.height/2-this.outlineThickness,item.rectangle.width+this.outlineThickness*2+2,item.rectangle.height+this.outlineThickness*2+2)}}};ThumbnailCarousel.prototype.renderThumbnails=function(){this.context2d.clearRect(this.x,this.y,this.width,this.height);this.items.sort(ThumbnailCarousel.itemsScaleSort);if(this.outlineColor){this.renderThumbnailOutlines()}if(this.shadowColor){this.context2d.shadowColor=this.shadowColor;this.context2d.shadowBlur=3;this.context2d.shadowOffsetX=2;this.context2d.shadowOffsetY=2}for(var b=0;b<this.items.length;b++){item=this.items[b];if(SimpleGeometry.constrainRadianTo2PI(item.radian)<=Math.PI){this.context2d.drawImage(item.image,item.rectangle.x-item.rectangle.width/2,item.rectangle.y-item.rectangle.height/2,item.rectangle.width,item.rectangle.height)}}this.context2d.shadowOffsetX=0;this.context2d.shadowOffsetY=0;this.context2d.shadowBlur=0;this.arrows.render(this.context2d)};ThumbnailCarousel.prototype.updateCurrentIndex=function(b){this.currentIndex+=b;this.currentIndex=this.currentIndex>=this.images.length?0:this.currentIndex;this.currentIndex=this.currentIndex<0?this.images.length-1:this.currentIndex};ThumbnailCarousel.prototype.slide=function(b){this.anchorItemRadian=Math.PI/2+this.currentIndex*this.segmentRadian;this.updateCurrentIndex(b);this.anchorItemTargetRadian=Math.PI/2+this.currentIndex*this.segmentRadian;if(Math.abs(this.anchorItemTargetRadian-this.anchorItemRadian)>Math.PI){if(this.anchorItemTargetRadian>this.anchorItemRadian){this.anchorItemTargetRadian-=SimpleGeometry.PI2}else{this.anchorItemTargetRadian+=SimpleGeometry.PI2}}var c=this;this.animator.reset(500,20,function(){c.rotate()});this.animator.start()};ThumbnailCarousel.prototype.rotate=function(){var e=this.anchorItemRadian+(this.anchorItemTargetRadian-this.anchorItemRadian)*this.animator.getAnimationPercent();var b=this.getCenter();var d;for(var c=0;c<this.items.length;c++){d=this.items[c];d.radian=e+(d.itemId*this.segmentRadian);d.rectangle.x=b.x+Math.cos(d.radian)*this.radius;d.scale=SimpleGeometry.map(Math.max(b.x,d.rectangle.x)-Math.min(b.x,d.rectangle.x),0,this.radius,1,0.5);d.rectangle.width=d.scale*d.image.width;d.rectangle.height=d.scale*d.image.height}this.renderThumbnails()};a.ThumbnailCarousel=ThumbnailCarousel;ThumbnailCarouselItem=function(f,c,e,d,b){this.itemId=f;this.image=c;this.scale=isNaN(e)?1:e;this.radian=isNaN(d)?0:d;this.rectangle=b?b:new SimpleGeometry.Rectangle()};a.ThumbnailCarouselItem=ThumbnailCarouselItem}(window));