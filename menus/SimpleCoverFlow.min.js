(function(a){SimpleCoverFlow=function(d,f,e,c,b){SimpleGeometry.Rectangle.call(this,d,f,e,c);this.vanishingPoint=this.getCenter();this.context2d=b;this.animator=new UnitAnimator();this.animationTransformRectangle=new TransformRectangle();this.arrows=new ArrowButtons(this);this.margin=40;this.unfocusedItemWidthPercent=0.5;this.currentIndex=0};SimpleCoverFlow.prototype=Object.create(SimpleGeometry.Rectangle.prototype);SimpleCoverFlow.prototype.constructor=SimpleGeometry.Rectangle;SimpleCoverFlow.prototype.next=function(){if(!this.hasNext()||this.animator.isAnimating()){return}this.slideDirection=1;this.slide()};SimpleCoverFlow.prototype.previous=function(){if(!this.hasPrevious()||this.animator.isAnimating()){return}this.slideDirection=-1;this.slide()};SimpleCoverFlow.prototype.hasNext=function(){return this.images&&this.currentIndex<this.images.length-1};SimpleCoverFlow.prototype.hasPrevious=function(){return this.images&&this.currentIndex>0};SimpleCoverFlow.prototype.getCurrentImage=function(){return this.images[this.currentIndex]};SimpleCoverFlow.prototype.setImages=function(b){this.images=b;this.setCardTargets(b[0]);this.cards=[];this.currentIndex=Math.floor(this.images.length/2);for(var c=0;c<this.targetTransformRectangles.length;c++){this.cards[c]=this.targetTransformRectangles[c].clone()}this.renderCurrentIndex()};SimpleCoverFlow.prototype.setCardTargets=function(f){this.targetTransformRectangles=[];var b=new SimpleGeometry.Rectangle(this.vanishingPoint.x-f.width/2,this.vanishingPoint.y-f.height/2,f.width,f.height);this.targetTransformRectangles[0]=new TransformRectangle(new SimpleGeometry.Point(b.x,b.y),new SimpleGeometry.Point(b.getRight(),b.y),new SimpleGeometry.Point(b.getRight(),b.getBottom()),new SimpleGeometry.Point(b.x,b.getBottom()));var d=b.height/6;var g=0.6;var e,c;this.numSideCards=0;while(b.getRight()<this.width-this.margin){b.x+=b.width;b.width*=g;d-=3;c=new TransformRectangle(new SimpleGeometry.Point(b.x,b.y+d),new SimpleGeometry.Point(b.getRight(),b.y),new SimpleGeometry.Point(b.getRight(),b.getBottom()),new SimpleGeometry.Point(b.x,b.getBottom()-d));this.targetTransformRectangles.push(c);e=new TransformRectangle(new SimpleGeometry.Point(this.width-b.getRight(),b.y),new SimpleGeometry.Point(this.width-b.x,b.y+d),new SimpleGeometry.Point(this.width-b.x,b.getBottom()-d),new SimpleGeometry.Point(this.width-b.getRight(),b.getBottom()));this.targetTransformRectangles.unshift(e);this.numSideCards++}};SimpleCoverFlow.prototype.renderCurrentIndex=function(){this.context2d.clearRect(this.x,this.y,this.width,this.height);for(var b=0;b<this.numSideCards;b++){this.cards[b].render(this.context2d,this.images[this.currentIndex-this.numSideCards+b]);this.cards[this.cards.length-b-1].render(this.context2d,this.images[this.currentIndex-this.numSideCards+this.cards.length-b-1])}this.cards[b].render(this.context2d,this.images[this.currentIndex-this.numSideCards+b]);this.arrows.render(this.context2d)};SimpleCoverFlow.prototype.updateAnimationTransformRectangle=function(d,c,b){this.animationTransformRectangle.topLeft.x=c.topLeft.x+(d.topLeft.x-c.topLeft.x)*b;this.animationTransformRectangle.topLeft.y=c.topLeft.y+(d.topLeft.y-c.topLeft.y)*b;this.animationTransformRectangle.topRight.x=c.topRight.x+(d.topRight.x-c.topRight.x)*b;this.animationTransformRectangle.topRight.y=c.topRight.y+(d.topRight.y-c.topRight.y)*b;this.animationTransformRectangle.bottomRight.x=c.bottomRight.x+(d.bottomRight.x-c.bottomRight.x)*b;this.animationTransformRectangle.bottomRight.y=c.bottomRight.y+(d.bottomRight.y-c.bottomRight.y)*b;this.animationTransformRectangle.bottomLeft.x=c.bottomLeft.x+(d.bottomLeft.x-c.bottomLeft.x)*b;this.animationTransformRectangle.bottomLeft.y=c.bottomLeft.y+(d.bottomLeft.y-c.bottomLeft.y)*b};SimpleCoverFlow.prototype.slideLeft=function(){this.context2d.clearRect(this.x,this.y,this.width,this.height);var b;for(var c=1;c<this.cards.length;c++){b=this.cards[c];this.updateAnimationTransformRectangle(this.targetTransformRectangles[c-1],this.targetTransformRectangles[c],this.animator.getAnimationPercent());b.updatePointsToTransformRectangle(this.animationTransformRectangle)}this.renderCurrentIndex()};SimpleCoverFlow.prototype.slideRight=function(){this.context2d.clearRect(this.x,this.y,this.width,this.height);var b;for(var c=0;c<this.cards.length-1;c++){b=this.cards[c];this.updateAnimationTransformRectangle(this.targetTransformRectangles[c+1],this.targetTransformRectangles[c],this.animator.getAnimationPercent());b.updatePointsToTransformRectangle(this.animationTransformRectangle)}this.renderCurrentIndex()};SimpleCoverFlow.prototype.slide=function(){var b=this;this.animator.reset(300,20,function(){b.slideDirection==1?b.slideLeft():b.slideRight()},function(){b.slideComplete()});this.animator.start()};SimpleCoverFlow.prototype.slideComplete=function(){this.currentIndex+=this.slideDirection;for(var b=0;b<this.targetTransformRectangles.length;b++){this.cards[b].updatePointsToTransformRectangle(this.targetTransformRectangles[b])}this.renderCurrentIndex()};a.SimpleCoverFlow=SimpleCoverFlow}(window));