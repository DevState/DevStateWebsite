(function(a){BlockSetAnimator=function(c,e,d,b){SimpleGeometry.Point.call(this,c,e);this.frameRate=20;this.intervalId=-1;this.easingFunction=UnitAnimator.easeOutSine;this.animator=new UnitAnimator(1000,20);this.animator.easingFunction=UnitAnimator.easeLinear};BlockSetAnimator.prototype=Object.create(SimpleGeometry.Point.prototype);BlockSetAnimator.prototype.constructor=SimpleGeometry.Point;BlockSetAnimator.prototype.setEasingFunction=function(b){this.easingFunction=b};BlockSetAnimator.prototype.setImages=function(b){this.blocks=[];var c=this.x;for(var d=0;d<b.length;d++){this.blocks[d]=new AnimationBlock(c,this.y,b[d]);c+=this.blocks[d].width}};BlockSetAnimator.prototype.isAnimating=function(){return this.animator&&this.animator.isAnimating()};BlockSetAnimator.prototype.setAnimation=function(b,c){this.transformFrom=b;this.transformTo=c};BlockSetAnimator.prototype.start=function(f,b,d,e){if(!this.blocks||this.blocks.length==0){console.log("BlockSetAnimator.start() ERROR : no blocks have been set");return}this.millisecondsAnimated=0;this.duration=f;this.blockAnimationDuration=this.duration-b*(this.blocks.length-1);this.completeCallBack=d?d:undefined;this.updateCallBack=e?e:undefined;for(var c=0;c<this.blocks.length;c++){this.blocks[c].animationBeginsAt=b*c;this.blocks[c].animationEndsAt=b*c+this.blockAnimationDuration;this.blocks[c].copyTransformValues(this.transformFrom)}var g=this;this.animator.reset(f,this.frameRate,function(){g.update()},function(){g.complete()});this.animator.start()};BlockSetAnimator.prototype.pause=function(){};BlockSetAnimator.prototype.resume=function(){};BlockSetAnimator.prototype.reset=function(){};BlockSetAnimator.prototype.reverse=function(){};BlockSetAnimator.prototype.update=function(){this.millisecondsAnimated+=this.frameRate;this.dispatchUpdate()};BlockSetAnimator.prototype.setBlockTransform=function(c){var b=SimpleGeometry.normalize(this.millisecondsAnimated,c.animationBeginsAt,c.animationEndsAt);c.transform.rotation=this.easingFunction(b,this.transformFrom.rotation,this.transformTo.rotation-this.transformFrom.rotation,1);c.transform.scale=this.easingFunction(b,this.transformFrom.scale,this.transformTo.scale-this.transformFrom.scale,1);c.transform.alpha=this.easingFunction(b,this.transformFrom.alpha,this.transformTo.alpha-this.transformFrom.alpha,1);c.transform.x=this.easingFunction(b,this.transformFrom.x,this.transformTo.x-this.transformFrom.x,1);c.transform.y=this.easingFunction(b,this.transformFrom.y,this.transformTo.y-this.transformFrom.y,1)};BlockSetAnimator.prototype.render=function(c){var d;SimpleGeometry.setIdentityMatrixToContext(c);for(var b=0;b<this.blocks.length;b++){d=this.blocks[b];if(this.millisecondsAnimated<=d.animationBeginsAt){d.copyTransformValues(this.transformFrom)}else{if(this.millisecondsAnimated>=d.animationEndsAt){d.copyTransformValues(this.transformTo)}else{this.setBlockTransform(d,b)}}c.translate(d.x+d.transform.x-d.getTranslateX(),d.y+d.transform.y-d.getTranslateY());c.rotate(d.transform.rotation);c.scale(d.transform.scale,d.transform.scale);c.globalAlpha=d.transform.alpha;c.drawImage(d.image,d.getTranslateX(),d.getTranslateY());SimpleGeometry.setIdentityMatrixToContext(c)}c.globalAlpha=1};BlockSetAnimator.prototype.dispatchUpdate=function(){if(this.updateCallBack){this.updateCallBack()}};BlockSetAnimator.prototype.complete=function(){this.dispatchComplete()};BlockSetAnimator.prototype.dispatchComplete=function(){if(this.completeCallBack){this.completeCallBack()}};a.BlockSetAnimator=BlockSetAnimator;AnimationBlock=function(b,d,c){SimpleGeometry.Rectangle.call(this,b,d,c.width,c.height);this.image=c;this.transform=new SimpleGeometry.Transform();this.skipRender=true;this.animationBeginsAt=0;this.animationEndsAt=0};AnimationBlock.prototype=Object.create(SimpleGeometry.Rectangle.prototype);AnimationBlock.prototype.constructor=SimpleGeometry.Rectangle;AnimationBlock.prototype.copyTransformValues=function(b){this.transform.scale=b.scale;this.transform.rotation=b.rotation;this.transform.x=b.x;this.transform.y=b.y;this.transform.alpha=b.alpha;this.transform.horizontalAlign=b.horizontalAlign;this.transform.verticalAlign=b.verticalAlign};AnimationBlock.prototype.getTranslateX=function(){switch(this.transform.horizontalAlign){case 1:return -this.width/2;case 2:return -this.width}return 0};AnimationBlock.prototype.getTranslateY=function(){switch(this.transform.verticalAlign){case 1:return -this.height/2;case 2:return -this.height}return 0};a.AnimationBlock=AnimationBlock;AnimationBlockTransform=function(b,h,f,d,e,c,g){this.x=isNaN(b)?0:b;this.y=isNaN(h)?0:h;this.scale=isNaN(f)?1:f;this.rotation=isNaN(d)?0:d;this.alpha=isNaN(e)?1:e;this.horizontalAlign=isNaN(c)&&c<3?0:c;this.verticalAlign=isNaN(g)&&g<3?0:g};a.AnimationBlockTransform=AnimationBlockTransform}(window));