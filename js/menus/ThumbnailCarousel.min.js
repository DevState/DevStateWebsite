!function(a){ThumbnailCarousel=function(a,b,c,d,e,f){SimpleGeometry.Rectangle.call(this,a,b,c,d),this.context2d=e,this.outlineThickness=4,this.animator=new UnitAnimator,this.arrows=new ArrowButtons(this),this.hotSpot=new SimpleGeometry.Rectangle,f&&this.setImages(f)},ThumbnailCarousel.prototype=Object.create(SimpleGeometry.Rectangle.prototype),ThumbnailCarousel.prototype.constructor=SimpleGeometry.Rectangle,ThumbnailCarousel.prototype.next=function(){this.animator.isAnimating()||this.slide(1)},ThumbnailCarousel.prototype.previous=function(){this.animator.isAnimating()||this.slide(-1)},ThumbnailCarousel.prototype.getCurrentImage=function(){for(var a=0;a<this.items.length;a++)if(this.items[a].itemId==(0==this.currentIndex?0:this.images.length-this.currentIndex))return this.items[a].image;return null},ThumbnailCarousel.prototype.setImages=function(a){this.images=a,this.radius=this.width/2-a[0].width/2,this.segmentRadian=SimpleGeometry.PI2/this.images.length,this.currentIndex=0,this.setUpCarousel(),this.renderThumbnails()},ThumbnailCarousel.prototype.setUpCarousel=function(){this.items=[];for(var a,b,c=Math.PI/2,d=this.getCenter(),e=0;e<this.images.length;e++)a=new SimpleGeometry.Rectangle,a.x=d.x+Math.cos(c)*this.radius,a.y=d.y,b=SimpleGeometry.map(Math.max(d.x,a.x)-Math.min(d.x,a.x),0,this.radius,1,.5),a.width=b*this.images[e].width,a.height=b*this.images[e].height,this.items[e]=new ThumbnailCarouselItem(e,this.images[e],b,SimpleGeometry.constrainRadianTo2PI(c),a),c+=this.segmentRadian;this.anchorItem=this.items[0],this.hotSpot=new SimpleGeometry.Rectangle(this.anchorItem.rectangle.x-this.anchorItem.rectangle.width/2,this.anchorItem.rectangle.y-this.anchorItem.rectangle.height/2,this.anchorItem.rectangle.width,this.anchorItem.rectangle.height)},ThumbnailCarousel.itemsScaleSort=function(a,b){return parseFloat(a.scale)-parseFloat(b.scale)},ThumbnailCarousel.prototype.renderThumbnailOutlines=function(){this.context2d.fillStyle=this.outlineColor;for(var a=0;a<this.items.length;a++)item=this.items[a],SimpleGeometry.constrainRadianTo2PI(item.radian)<=Math.PI&&this.context2d.fillRect(item.rectangle.x-item.rectangle.width/2-this.outlineThickness,item.rectangle.y-item.rectangle.height/2-this.outlineThickness,item.rectangle.width+2*this.outlineThickness+2,item.rectangle.height+2*this.outlineThickness+2)},ThumbnailCarousel.prototype.renderThumbnails=function(){this.context2d.clearRect(this.x,this.y,this.width,this.height),this.items.sort(ThumbnailCarousel.itemsScaleSort),this.outlineColor&&this.renderThumbnailOutlines(),this.shadowColor&&(this.context2d.shadowColor=this.shadowColor,this.context2d.shadowBlur=3,this.context2d.shadowOffsetX=2,this.context2d.shadowOffsetY=2);for(var a=0;a<this.items.length;a++)item=this.items[a],SimpleGeometry.constrainRadianTo2PI(item.radian)<=Math.PI&&this.context2d.drawImage(item.image,item.rectangle.x-item.rectangle.width/2,item.rectangle.y-item.rectangle.height/2,item.rectangle.width,item.rectangle.height);this.context2d.shadowOffsetX=0,this.context2d.shadowOffsetY=0,this.context2d.shadowBlur=0,this.arrows.render(this.context2d)},ThumbnailCarousel.prototype.updateCurrentIndex=function(a){this.currentIndex+=a,this.currentIndex=this.currentIndex>=this.images.length?0:this.currentIndex,this.currentIndex=this.currentIndex<0?this.images.length-1:this.currentIndex},ThumbnailCarousel.prototype.slide=function(a){this.anchorItemRadian=Math.PI/2+this.currentIndex*this.segmentRadian,this.updateCurrentIndex(a),this.anchorItemTargetRadian=Math.PI/2+this.currentIndex*this.segmentRadian,Math.abs(this.anchorItemTargetRadian-this.anchorItemRadian)>Math.PI&&(this.anchorItemTargetRadian>this.anchorItemRadian?this.anchorItemTargetRadian-=SimpleGeometry.PI2:this.anchorItemTargetRadian+=SimpleGeometry.PI2);var b=this;this.animator.reset(500,20,function(){b.rotate()}),this.animator.start()},ThumbnailCarousel.prototype.rotate=function(){for(var a,b=this.anchorItemRadian+(this.anchorItemTargetRadian-this.anchorItemRadian)*this.animator.getAnimationPercent(),c=this.getCenter(),d=0;d<this.items.length;d++)a=this.items[d],a.radian=b+a.itemId*this.segmentRadian,a.rectangle.x=c.x+Math.cos(a.radian)*this.radius,a.scale=SimpleGeometry.map(Math.max(c.x,a.rectangle.x)-Math.min(c.x,a.rectangle.x),0,this.radius,1,.5),a.rectangle.width=a.scale*a.image.width,a.rectangle.height=a.scale*a.image.height;this.renderThumbnails()},a.ThumbnailCarousel=ThumbnailCarousel,ThumbnailCarouselItem=function(a,b,c,d,e){this.itemId=a,this.image=b,this.scale=isNaN(c)?1:c,this.radian=isNaN(d)?0:d,this.rectangle=e?e:new SimpleGeometry.Rectangle},a.ThumbnailCarouselItem=ThumbnailCarouselItem}(window);