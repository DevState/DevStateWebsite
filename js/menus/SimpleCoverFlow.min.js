!function(a){SimpleCoverFlow=function(a,b,c,d,e){SimpleGeometry.Rectangle.call(this,a,b,c,d),this.vanishingPoint=this.getCenter(),this.context2d=e,this.animator=new UnitAnimator,this.animationTransformRectangle=new TransformRectangle,this.arrows=new ArrowButtons(this),this.margin=40,this.unfocusedItemWidthPercent=.5,this.currentIndex=0},SimpleCoverFlow.prototype=Object.create(SimpleGeometry.Rectangle.prototype),SimpleCoverFlow.prototype.constructor=SimpleGeometry.Rectangle,SimpleCoverFlow.prototype.next=function(){this.hasNext()&&!this.animator.isAnimating()&&(this.slideDirection=1,this.slide())},SimpleCoverFlow.prototype.previous=function(){this.hasPrevious()&&!this.animator.isAnimating()&&(this.slideDirection=-1,this.slide())},SimpleCoverFlow.prototype.hasNext=function(){return this.images&&this.currentIndex<this.images.length-1},SimpleCoverFlow.prototype.hasPrevious=function(){return this.images&&this.currentIndex>0},SimpleCoverFlow.prototype.getCurrentImage=function(){return this.images[this.currentIndex]},SimpleCoverFlow.prototype.setImages=function(a){this.images=a,this.setCardTargets(a[0]),this.cards=[],this.currentIndex=Math.floor(this.images.length/2);for(var b=0;b<this.targetTransformRectangles.length;b++)this.cards[b]=this.targetTransformRectangles[b].clone();this.renderCurrentIndex()},SimpleCoverFlow.prototype.setCardTargets=function(a){this.targetTransformRectangles=[];var b=new SimpleGeometry.Rectangle(this.vanishingPoint.x-a.width/2,this.vanishingPoint.y-a.height/2,a.width,a.height);this.targetTransformRectangles[0]=new TransformRectangle(new SimpleGeometry.Point(b.x,b.y),new SimpleGeometry.Point(b.getRight(),b.y),new SimpleGeometry.Point(b.getRight(),b.getBottom()),new SimpleGeometry.Point(b.x,b.getBottom()));var c,d,e=b.height/6,f=.6;for(this.numSideCards=0;b.getRight()<this.width-this.margin;)b.x+=b.width,b.width*=f,e-=3,d=new TransformRectangle(new SimpleGeometry.Point(b.x,b.y+e),new SimpleGeometry.Point(b.getRight(),b.y),new SimpleGeometry.Point(b.getRight(),b.getBottom()),new SimpleGeometry.Point(b.x,b.getBottom()-e)),this.targetTransformRectangles.push(d),c=new TransformRectangle(new SimpleGeometry.Point(this.width-b.getRight(),b.y),new SimpleGeometry.Point(this.width-b.x,b.y+e),new SimpleGeometry.Point(this.width-b.x,b.getBottom()-e),new SimpleGeometry.Point(this.width-b.getRight(),b.getBottom())),this.targetTransformRectangles.unshift(c),this.numSideCards++},SimpleCoverFlow.prototype.renderCurrentIndex=function(){this.context2d.clearRect(this.x,this.y,this.width,this.height);for(var a=0;a<this.numSideCards;a++)this.cards[a].render(this.context2d,this.images[this.currentIndex-this.numSideCards+a]),this.cards[this.cards.length-a-1].render(this.context2d,this.images[this.currentIndex-this.numSideCards+this.cards.length-a-1]);this.cards[a].render(this.context2d,this.images[this.currentIndex-this.numSideCards+a]),this.arrows.render(this.context2d)},SimpleCoverFlow.prototype.updateAnimationTransformRectangle=function(a,b,c){this.animationTransformRectangle.topLeft.x=b.topLeft.x+(a.topLeft.x-b.topLeft.x)*c,this.animationTransformRectangle.topLeft.y=b.topLeft.y+(a.topLeft.y-b.topLeft.y)*c,this.animationTransformRectangle.topRight.x=b.topRight.x+(a.topRight.x-b.topRight.x)*c,this.animationTransformRectangle.topRight.y=b.topRight.y+(a.topRight.y-b.topRight.y)*c,this.animationTransformRectangle.bottomRight.x=b.bottomRight.x+(a.bottomRight.x-b.bottomRight.x)*c,this.animationTransformRectangle.bottomRight.y=b.bottomRight.y+(a.bottomRight.y-b.bottomRight.y)*c,this.animationTransformRectangle.bottomLeft.x=b.bottomLeft.x+(a.bottomLeft.x-b.bottomLeft.x)*c,this.animationTransformRectangle.bottomLeft.y=b.bottomLeft.y+(a.bottomLeft.y-b.bottomLeft.y)*c},SimpleCoverFlow.prototype.slideLeft=function(){this.context2d.clearRect(this.x,this.y,this.width,this.height);for(var a,b=1;b<this.cards.length;b++)a=this.cards[b],this.updateAnimationTransformRectangle(this.targetTransformRectangles[b-1],this.targetTransformRectangles[b],this.animator.getAnimationPercent()),a.updatePointsToTransformRectangle(this.animationTransformRectangle);this.renderCurrentIndex()},SimpleCoverFlow.prototype.slideRight=function(){this.context2d.clearRect(this.x,this.y,this.width,this.height);for(var a,b=0;b<this.cards.length-1;b++)a=this.cards[b],this.updateAnimationTransformRectangle(this.targetTransformRectangles[b+1],this.targetTransformRectangles[b],this.animator.getAnimationPercent()),a.updatePointsToTransformRectangle(this.animationTransformRectangle);this.renderCurrentIndex()},SimpleCoverFlow.prototype.slide=function(){var a=this;this.animator.reset(300,20,function(){1==a.slideDirection?a.slideLeft():a.slideRight()},function(){a.slideComplete()}),this.animator.start()},SimpleCoverFlow.prototype.slideComplete=function(){this.currentIndex+=this.slideDirection;for(var a=0;a<this.targetTransformRectangles.length;a++)this.cards[a].updatePointsToTransformRectangle(this.targetTransformRectangles[a]);this.renderCurrentIndex()},a.SimpleCoverFlow=SimpleCoverFlow}(window);