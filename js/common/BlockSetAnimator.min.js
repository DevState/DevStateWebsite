!function(a){BlockSetAnimator=function(a,b){SimpleGeometry.Point.call(this,a,b),this.frameRate=20,this.intervalId=-1,this.easingFunction=UnitAnimator.easeOutSine,this.animator=new UnitAnimator(1e3,20),this.animator.easingFunction=UnitAnimator.easeLinear},BlockSetAnimator.prototype=Object.create(SimpleGeometry.Point.prototype),BlockSetAnimator.prototype.constructor=SimpleGeometry.Point,BlockSetAnimator.prototype.setEasingFunction=function(a){this.easingFunction=a},BlockSetAnimator.prototype.setImages=function(a){this.blocks=[];for(var b=this.x,c=0;c<a.length;c++)this.blocks[c]=new AnimationBlock(b,this.y,a[c]),b+=this.blocks[c].width},BlockSetAnimator.prototype.isAnimating=function(){return this.animator&&this.animator.isAnimating()},BlockSetAnimator.prototype.setAnimation=function(a,b){this.transformFrom=a,this.transformTo=b},BlockSetAnimator.prototype.start=function(a,b,c,d){if(!this.blocks||0==this.blocks.length)return console.log("BlockSetAnimator.start() ERROR : no blocks have been set"),void 0;this.millisecondsAnimated=0,this.duration=a,this.blockAnimationDuration=this.duration-b*(this.blocks.length-1),this.completeCallBack=c?c:void 0,this.updateCallBack=d?d:void 0;for(var e=0;e<this.blocks.length;e++)this.blocks[e].animationBeginsAt=b*e,this.blocks[e].animationEndsAt=b*e+this.blockAnimationDuration,this.blocks[e].copyTransformValues(this.transformFrom);var f=this;this.animator.reset(a,this.frameRate,function(){f.update()},function(){f.complete()}),this.animator.start()},BlockSetAnimator.prototype.pause=function(){},BlockSetAnimator.prototype.resume=function(){},BlockSetAnimator.prototype.reset=function(){},BlockSetAnimator.prototype.reverse=function(){},BlockSetAnimator.prototype.update=function(){this.millisecondsAnimated+=this.frameRate,this.dispatchUpdate()},BlockSetAnimator.prototype.setBlockTransform=function(a){var b=SimpleGeometry.normalize(this.millisecondsAnimated,a.animationBeginsAt,a.animationEndsAt);a.transform.rotation=this.easingFunction(b,this.transformFrom.rotation,this.transformTo.rotation-this.transformFrom.rotation,1),a.transform.scale=this.easingFunction(b,this.transformFrom.scale,this.transformTo.scale-this.transformFrom.scale,1),a.transform.alpha=this.easingFunction(b,this.transformFrom.alpha,this.transformTo.alpha-this.transformFrom.alpha,1),a.transform.x=this.easingFunction(b,this.transformFrom.x,this.transformTo.x-this.transformFrom.x,1),a.transform.y=this.easingFunction(b,this.transformFrom.y,this.transformTo.y-this.transformFrom.y,1)},BlockSetAnimator.prototype.render=function(a){var b;SimpleGeometry.setIdentityMatrixToContext(a);for(var c=0;c<this.blocks.length;c++)b=this.blocks[c],this.millisecondsAnimated<=b.animationBeginsAt?b.copyTransformValues(this.transformFrom):this.millisecondsAnimated>=b.animationEndsAt?b.copyTransformValues(this.transformTo):this.setBlockTransform(b,c),a.translate(b.x+b.transform.x-b.getTranslateX(),b.y+b.transform.y-b.getTranslateY()),a.rotate(b.transform.rotation),a.scale(b.transform.scale,b.transform.scale),a.globalAlpha=b.transform.alpha,a.drawImage(b.image,b.getTranslateX(),b.getTranslateY()),SimpleGeometry.setIdentityMatrixToContext(a);a.globalAlpha=1},BlockSetAnimator.prototype.dispatchUpdate=function(){this.updateCallBack&&this.updateCallBack()},BlockSetAnimator.prototype.complete=function(){this.dispatchComplete()},BlockSetAnimator.prototype.dispatchComplete=function(){this.completeCallBack&&this.completeCallBack()},a.BlockSetAnimator=BlockSetAnimator,AnimationBlock=function(a,b,c){SimpleGeometry.Rectangle.call(this,a,b,c.width,c.height),this.image=c,this.transform=new SimpleGeometry.Transform,this.skipRender=!0,this.animationBeginsAt=0,this.animationEndsAt=0},AnimationBlock.prototype=Object.create(SimpleGeometry.Rectangle.prototype),AnimationBlock.prototype.constructor=SimpleGeometry.Rectangle,AnimationBlock.prototype.copyTransformValues=function(a){this.transform.scale=a.scale,this.transform.rotation=a.rotation,this.transform.x=a.x,this.transform.y=a.y,this.transform.alpha=a.alpha,this.transform.horizontalAlign=a.horizontalAlign,this.transform.verticalAlign=a.verticalAlign},AnimationBlock.prototype.getTranslateX=function(){switch(this.transform.horizontalAlign){case 1:return-this.width/2;case 2:return-this.width}return 0},AnimationBlock.prototype.getTranslateY=function(){switch(this.transform.verticalAlign){case 1:return-this.height/2;case 2:return-this.height}return 0},a.AnimationBlock=AnimationBlock,AnimationBlockTransform=function(a,b,c,d,e,f,g){this.x=isNaN(a)?0:a,this.y=isNaN(b)?0:b,this.scale=isNaN(c)?1:c,this.rotation=isNaN(d)?0:d,this.alpha=isNaN(e)?1:e,this.horizontalAlign=isNaN(f)&&3>f?0:f,this.verticalAlign=isNaN(g)&&3>g?0:g},a.AnimationBlockTransform=AnimationBlockTransform}(window);