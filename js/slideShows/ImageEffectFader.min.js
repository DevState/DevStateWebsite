!function(a){ImageEffectFader=function(a,b,c,d,e){SimpleGeometry.Rectangle.call(this,a,b,c,d),this.context2d=e,this.animator=new UnitAnimator},ImageEffectFader.prototype=Object.create(SimpleGeometry.Rectangle.prototype),ImageEffectFader.prototype.constructor=SimpleGeometry.Rectangle,ImageEffectFader.easingFunctions=[UnitAnimator.easeInSine,UnitAnimator.easeInOutSine,UnitAnimator.easeOutBounce,UnitAnimator.easeInBounce],ImageEffectFader.getRandomEasingFunction=function(){return ImageEffectFader.easingFunctions[Math.floor(Math.random()*ImageEffectFader.easingFunctions.length)]},ImageEffectFader.prototype.setImage=function(a){if(!this.animator.isAnimating()){this.image&&(this.previousImage=this.image),this.image=new Image,this.image.width=this.width,this.image.height=this.height,this.image.src=a;var b=this;this.spinner=new SimpleLoaderGraphic(this.width/2,this.height/2,25,function(){b.updateSpinner()}),this.spinner.play(),this.image.onload=function(){b.showImage()}}},ImageEffectFader.prototype.updateSpinner=function(){this.context2d.clearRect(0,0,this.width,this.height),this.previousImage&&this.context2d.drawImage(this.previousImage,0,0,this.width,this.height),this.spinner.render(this.context2d)},ImageEffectFader.prototype.showImage=function(){if(this.spinner&&(this.spinner.pause(),delete this.spinner),this.previousImage)return this.startFadeOut(),void 0;var a=this;this.fadeImage=ImageEffects.createRandomEffectImageFrom(this.image,this.width,this.height),this.animator.easingFunction=UnitAnimator.easeInSine,this.animator.reset(500,20,function(){a.fadeIn()},function(){a.fadeInComplete()}),this.animator.start()},ImageEffectFader.prototype.fadeIn=function(){this.context2d.drawImage(this.fadeImage,0,0,this.width,this.height),this.context2d.fillStyle=SimpleGeometry.getRgbaStyleString(255,255,255,1-this.animator.getAnimationPercent()),this.context2d.fillRect(0,0,this.width,this.height)},ImageEffectFader.prototype.fadeInComplete=function(){var a=this;this.animator.easingFunction=ImageEffectFader.getRandomEasingFunction(),this.animator.reset(1500,20,function(){a.updateEffect()},function(){a.effectComplete()}),this.animator.start()},ImageEffectFader.prototype.startFadeOut=function(){var a=this;this.animator.easingFunction=UnitAnimator.easeInSine,this.animator.reset(500,20,function(){a.fadeOut()},function(){a.fadeOutComplete()}),this.animator.start()},ImageEffectFader.prototype.fadeOut=function(){this.context2d.drawImage(this.previousImage,0,0,this.width,this.height),this.context2d.fillStyle=SimpleGeometry.getRgbaStyleString(255,255,255,this.animator.getAnimationPercent()),this.context2d.fillRect(0,0,this.width,this.height)},ImageEffectFader.prototype.fadeOutComplete=function(){delete this.previousImage,this.showImage()},ImageEffectFader.prototype.updateEffect=function(){this.context2d.drawImage(this.image,0,0,this.width,this.height),this.context2d.globalAlpha=1-this.animator.getAnimationPercent(),this.context2d.drawImage(this.fadeImage,0,0,this.width,this.height),this.context2d.globalAlpha=1},ImageEffectFader.prototype.effectComplete=function(){this.context2d.drawImage(this.image,0,0,this.width,this.height)},a.ImageEffectFader=ImageEffectFader}(window);